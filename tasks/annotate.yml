---
# yamllint disable rule:line-length
###############################################################################
# Annotate User Configuration
###############################################################################
# VSFTPd uses very specific and strict config format, sanitize and map settings
# to the equivalent role settings.
#
# Use r_pufky.data.v3 data annotations to enforce consistency and validation
# checks.
#
# Generates:
#   _vsftpd_map: list of dict - Annotated config map.
#   _vsftpd_order: list of str - Config section order.
#
# Reference:
# * https://docs.paperless-ngx.com/setup/#bare_metal
# * https://docs.ansible.com/ansible/latest/dev_guide/developing_program_flow_modules.html#argument-spec
# * https://github.com/ansible/ansible/issues/77159
# yamllint enable rule:line-length

- name: 'Annotate | sanitize & annotate config defaults'
  ansible.builtin.set_fact:  # noqa jinja[spacing] readability.
    _vsftpd_cfg_accept_timeout: "{{ {} | r_pufky.data.v3(
        section='Default',
        key='accept_timeout',
        raw=vsftpd_cfg_accept_timeout,
        default=60,
        hint='int',
        order=1
        )
      }}"
    _vsftpd_cfg_allow_anon_ssl: "{{ {} | r_pufky.data.v3(
        section='Default',
        key='allow_anon_ssl',
        raw=vsftpd_cfg_allow_anon_ssl,
        default=false,
        hint='bool',
        order=2
        )
      }}"
    _vsftpd_cfg_anon_max_rate: "{{ {} | r_pufky.data.v3(
        section='Default',
        key='anon_max_rate',
        raw=vsftpd_cfg_anon_max_rate,
        default=0,
        hint='int',
        order=3
        )
      }}"
    _vsftpd_cfg_anon_mkdir_write_enable: "{{ {} | r_pufky.data.v3(
        section='Default',
        key='anon_mkdir_write_enable',
        raw=vsftpd_cfg_anon_mkdir_write_enable,
        default=false,
        hint='bool',
        order=4
        )
      }}"
    _vsftpd_cfg_anon_other_write_enable: "{{ {} | r_pufky.data.v3(
        section='Default',
        key='anon_other_write_enable',
        raw=vsftpd_cfg_anon_other_write_enable,
        default=false,
        hint='bool',
        order=5
        )
      }}"
    _vsftpd_cfg_anon_root: "{{ {} | r_pufky.data.v3(
        section='Default',
        key='anon_root',
        raw=vsftpd_cfg_anon_root,
        default='',
        hint='str',
        order=6
        )
      }}"
    _vsftpd_cfg_anon_umask: "{{ {} | r_pufky.data.v3(
        section='Default',
        key='anon_umask',
        raw=vsftpd_cfg_anon_umask,
        default='077',
        hint='str',
        order=7
        )
      }}"
    _vsftpd_cfg_anon_upload_enable: "{{ {} | r_pufky.data.v3(
        section='Default',
        key='anon_upload_enable',
        raw=vsftpd_cfg_anon_upload_enable,
        default=false,
        hint='bool',
        order=8
        )
      }}"
    _vsftpd_cfg_anon_world_readable_only: "{{ {} | r_pufky.data.v3(
        section='Default',
        key='anon_world_readable_only',
        raw=vsftpd_cfg_anon_world_readable_only,
        default=true,
        hint='bool',
        order=9
        )
      }}"
    _vsftpd_cfg_anonymous_enable: "{{ {} | r_pufky.data.v3(
        section='Default',
        key='anonymous_enable',
        raw=vsftpd_cfg_anonymous_enable,
        default=false,
        hint='bool',
        order=10
        )
      }}"
    _vsftpd_cfg_ascii_download_enable: "{{ {} | r_pufky.data.v3(
        section='Default',
        key='ascii_download_enable',
        raw=vsftpd_cfg_ascii_download_enable,
        default=false,
        hint='bool',
        order=11
        )
      }}"
    _vsftpd_cfg_ascii_upload_enable: "{{ {} | r_pufky.data.v3(
        section='Default',
        key='ascii_upload_enable',
        raw=vsftpd_cfg_ascii_upload_enable,
        default=false,
        hint='bool',
        order=12
        )
      }}"
    _vsftpd_cfg_async_abor_enable: "{{ {} | r_pufky.data.v3(
        section='Default',
        key='async_abor_enable',
        raw=vsftpd_cfg_async_abor_enable,
        default=false,
        hint='bool',
        order=13
        )
      }}"
    _vsftpd_cfg_background: "{{ {} | r_pufky.data.v3(
        section='Default',
        key='background',
        raw=vsftpd_cfg_background,
        default=false,
        hint='bool',
        order=14
        )
      }}"
    _vsftpd_cfg_banned_emails: "{{ {} | r_pufky.data.v3(
        section='Default',
        key='banned_email_file',
        raw=vsftpd_cfg_banned_emails,
        data=(
          vsftpd_role_service_dir ~ '/banned_emails'
          if vsftpd_cfg_banned_emails | length > 0 else
          ''
        ),
        default=[],
        _dest=vsftpd_role_service_dir ~ '/banned_emails',
        hint='list of str',
        sensitive=true,
        order=15
        )
      }}"
    _vsftpd_cfg_banner: "{{ {} | r_pufky.data.v3(
        section='Default',
        key='banner_file',
        raw=vsftpd_cfg_banner,
        data=(
          vsftpd_role_service_dir ~ '/banner_file'
          if vsftpd_cfg_banner | length > 0 else
          ''
        ),
        default='',
        _dest=vsftpd_role_service_dir ~ '/banner_file',
        hint='str',
        order=16
        )
      }}"
    _vsftpd_cfg_ca_certs_file: "{{ {} | r_pufky.data.v3(
        section='Default',
        key='ca_certs_file',
        raw=vsftpd_cfg_ca_certs_file,
        data=(
          vsftpd_role_service_dir ~ '/ca.cert'
          if vsftpd_cfg_ca_certs_file | length > 0 else
          ''
        ),
        default='',
        _src=vsftpd_cfg_ca_certs_file | regex_replace('\\/$', ''),
        _dest=vsftpd_role_service_dir ~ '/ca.cert',
        hint='str',
        added='2.0.6',
        sensitive=true,
        order=17
        )
      }}"
    _vsftpd_cfg_check_shell: "{{ {} | r_pufky.data.v3(
        section='Default',
        key='check_shell',
        raw=vsftpd_cfg_check_shell,
        default=true,
        hint='bool',
        order=18
        )
      }}"
    _vsftpd_cfg_chmod_enable: "{{ {} | r_pufky.data.v3(
        section='Default',
        key='chmod_enable',
        raw=vsftpd_cfg_chmod_enable,
        default=true,
        hint='bool',
        order=19
        )
      }}"
    _vsftpd_cfg_chown_upload_mode: "{{ {} | r_pufky.data.v3(
        section='Default',
        key='chown_upload_mode',
        raw=vsftpd_cfg_chown_upload_mode,
        default='0600',
        hint='str',
        added='2.0.6',
        order=20
        )
      }}"
    _vsftpd_cfg_chown_uploads: "{{ {} | r_pufky.data.v3(
        section='Default',
        key='chown_uploads',
        raw=vsftpd_cfg_chown_uploads,
        default=false,
        hint='bool',
        order=21
        )
      }}"
    _vsftpd_cfg_chown_username: "{{ {} | r_pufky.data.v3(
        section='Default',
        key='chown_username',
        raw=vsftpd_cfg_chown_username,
        default='root',
        hint='str',
        order=22
        )
      }}"
    _vsftpd_cfg_chroot_list_enable: "{{ {} | r_pufky.data.v3(
        section='Default',
        key='chroot_list_enable',
        raw=vsftpd_cfg_chroot_list_enable,
        default=false,
        hint='bool',
        order=23
        )
      }}"
    _vsftpd_cfg_chroot_list: "{{ {} | r_pufky.data.v3(
        section='Default',
        key='chroot_list_file',
        raw=vsftpd_cfg_chroot_list,
        data=(
          vsftpd_role_service_dir ~ '/chroot_list'
          if vsftpd_cfg_chroot_list | length > 0 else
          ''
        ),
        default=[],
        _dest=vsftpd_role_service_dir ~ '/chroot_list',
        hint='list of str',
        order=24
        )
      }}"
    _vsftpd_cfg_chroot_local_user: "{{ {} | r_pufky.data.v3(
        section='Default',
        key='chroot_local_user',
        raw=vsftpd_cfg_chroot_local_user,
        default=false,
        hint='bool',
        order=25
        )
      }}"
    _vsftpd_cfg_cmds_allowed: "{{ {} | r_pufky.data.v3(
        section='Default',
        key='cmds_allowed',
        raw=vsftpd_cfg_cmds_allowed,
        data=vsftpd_cfg_cmds_allowed | join(','),
        default=[],
        hint='str',
        order=26
        )
      }}"
    _vsftpd_cfg_cmds_denied: "{{ {} | r_pufky.data.v3(
        section='Default',
        key='cmds_denied',
        raw=vsftpd_cfg_cmds_denied,
        data=vsftpd_cfg_cmds_denied | join(','),
        default=[],
        hint='str',
        added='2.1.0',
        order=27
        )
      }}"
    _vsftpd_cfg_connect_from_port_20: "{{ {} | r_pufky.data.v3(
        section='Default',
        key='connect_from_port_20',
        raw=vsftpd_cfg_connect_from_port_20,
        default=true,
        hint='bool',
        order=28
        )
      }}"
    _vsftpd_cfg_connect_timeout: "{{ {} | r_pufky.data.v3(
        section='Default',
        key='connect_timeout',
        raw=vsftpd_cfg_connect_timeout,
        default=60,
        hint='int',
        order=29
        )
      }}"
    _vsftpd_cfg_data_connection_timeout: "{{ {} | r_pufky.data.v3(
        section='Default',
        key='data_connection_timeout',
        raw=vsftpd_cfg_data_connection_timeout,
        default=300,
        hint='int',
        order=30
        )
      }}"
    _vsftpd_cfg_debug_ssl: "{{ {} | r_pufky.data.v3(
        section='Default',
        key='debug_ssl',
        raw=vsftpd_cfg_debug_ssl,
        default=false,
        hint='bool',
        added='2.0.6',
        order=31
        )
      }}"
    _vsftpd_cfg_delay_failed_login: "{{ {} | r_pufky.data.v3(
        section='Default',
        key='delay_failed_login',
        raw=vsftpd_cfg_delay_failed_login,
        default=1,
        hint='int',
        order=32
        )
      }}"
    _vsftpd_cfg_delay_successful_login: "{{ {} | r_pufky.data.v3(
        section='Default',
        key='delay_successful_login',
        raw=vsftpd_cfg_delay_successful_login,
        default=0,
        hint='int',
        order=33
        )
      }}"
    _vsftpd_cfg_delete_failed_uploads: "{{ {} | r_pufky.data.v3(
        section='Default',
        key='delete_failed_uploads',
        raw=vsftpd_cfg_delete_failed_uploads,
        default=false,
        hint='bool',
        added='2.0.7',
        order=34
        )
      }}"
    _vsftpd_cfg_deny_email_enable: "{{ {} | r_pufky.data.v3(
        section='Default',
        key='deny_email_enable',
        raw=vsftpd_cfg_deny_email_enable,
        default=false,
        hint='bool',
        order=35
        )
      }}"
    _vsftpd_cfg_deny_file: "{{ {} | r_pufky.data.v3(
        section='Default',
        key='deny_file',
        raw=vsftpd_cfg_deny_file,
        data=(
          '{' ~ vsftpd_cfg_deny_file | join(',') ~ '}'
          if vsftpd_cfg_deny_file | length > 0 else
          ''
        ),
        hint='str',
        order=36
        )
      }}"
    _vsftpd_cfg_dirlist_enable: "{{ {} | r_pufky.data.v3(
        section='Default',
        key='dirlist_enable',
        raw=vsftpd_cfg_dirlist_enable,
        default=true,
        hint='bool',
        order=37
        )
      }}"
    _vsftpd_cfg_dirmessage_enable: "{{ {} | r_pufky.data.v3(
        section='Default',
        key='dirmessage_enable',
        raw=vsftpd_cfg_dirmessage_enable,
        default=true,
        hint='bool',
        order=38
        )
      }}"
    _vsftpd_cfg_download_enable: "{{ {} | r_pufky.data.v3(
        section='Default',
        key='download_enable',
        raw=vsftpd_cfg_download_enable,
        default=true,
        hint='bool',
        order=39
        )
      }}"
    _vsftpd_cfg_download_file: "{{ {} | r_pufky.data.v3(
        section='Default',
        key='download_file',
        raw=vsftpd_cfg_download_file,
        data=(
          '{' + vsftpd_cfg_download_file | join(',') + '}'
          if vsftpd_cfg_download_file | length > 0 else
          ''
        ),
        default=[],
        hint='list of str',
        order=40
        )
      }}"
    _vsftpd_cfg_dsa_cert_file: "{{ {} | r_pufky.data.v3(
        section='Default',
        key='dsa_cert_file',
        raw=vsftpd_cfg_dsa_cert_file,
        data=(
          vsftpd_role_service_dir ~ '/dsa.cert'
          if vsftpd_cfg_dsa_cert_file | length > 0 else
          ''
        ),
        default='',
        _src=vsftpd_cfg_dsa_cert_file | regex_replace('\\/$', ''),
        _dest=vsftpd_role_service_dir ~ '/dsa.cert',
        hint='str',
        sensitive=true,
        order=41
        )
      }}"
    _vsftpd_cfg_dsa_private_key_file: "{{ {} | r_pufky.data.v3(
        section='Default',
        key='dsa_private_key_file',
        raw=vsftpd_cfg_dsa_private_key_file,
        data=(
          vsftpd_role_service_dir ~ '/dsa.key'
          if vsftpd_cfg_dsa_private_key_file | length > 0 else
          ''
        ),
        default='',
        _src=vsftpd_cfg_dsa_private_key_file | regex_replace('\\/$', ''),
        _dest=vsftpd_role_service_dir ~ '/dsa.key',
        hint='str',
        sensitive=true,
        order=42
        )
      }}"
    _vsftpd_cfg_dual_log_enable: "{{ {} | r_pufky.data.v3(
        section='Default',
        key='dual_log_enable',
        raw=vsftpd_cfg_dual_log_enable,
        default=false,
        hint='bool',
        order=43
        )
      }}"
    _vsftpd_cfg_email_passwords: "{{ {} | r_pufky.data.v3(
        section='Default',
        key='email_password_file',
        raw=vsftpd_cfg_email_passwords,
        data=(
          vsftpd_role_service_dir ~ '/email_passwords'
          if vsftpd_cfg_email_passwords | length > 0 else
          ''
        ),
        default=[],
        _dest=vsftpd_role_service_dir ~ '/email_passwords',
        hint='list of str',
        sensitive=true,
        order=44
        )
      }}"
    _vsftpd_cfg_file_open_mode: "{{ {} | r_pufky.data.v3(
        section='Default',
        key='file_open_mode',
        raw=vsftpd_cfg_file_open_mode,
        default='0666',
        hint='str',
        order=45
        )
      }}"
    _vsftpd_cfg_force_anon_data_ssl: "{{ {} | r_pufky.data.v3(
        section='Default',
        key='force_anon_data_ssl',
        raw=vsftpd_cfg_force_anon_data_ssl,
        default=false,
        hint='bool',
        order=46
        )
      }}"
    _vsftpd_cfg_force_anon_logins_ssl: "{{ {} | r_pufky.data.v3(
        section='Default',
        key='force_anon_logins_ssl',
        raw=vsftpd_cfg_force_anon_logins_ssl,
        default=false,
        hint='bool',
        order=47
        )
      }}"
    _vsftpd_cfg_force_dot_files: "{{ {} | r_pufky.data.v3(
        section='Default',
        key='force_dot_files',
        raw=vsftpd_cfg_force_dot_files,
        default=false,
        hint='bool',
        order=48
        )
      }}"
    _vsftpd_cfg_force_local_data_ssl: "{{ {} | r_pufky.data.v3(
        section='Default',
        key='force_local_data_ssl',
        raw=vsftpd_cfg_force_local_data_ssl,
        default=true,
        hint='bool',
        order=49
        )
      }}"
    _vsftpd_cfg_force_local_logins_ssl: "{{ {} | r_pufky.data.v3(
        section='Default',
        key='force_local_logins_ssl',
        raw=vsftpd_cfg_force_local_logins_ssl,
        default=true,
        hint='bool',
        order=50
        )
      }}"
    _vsftpd_cfg_ftp_data_port: "{{ {} | r_pufky.data.v3(
        section='Default',
        key='ftp_data_port',
        raw=vsftpd_cfg_ftp_data_port,
        default=20,
        hint='int',
        order=51
        )
      }}"
    _vsftpd_cfg_ftp_username: "{{ {} | r_pufky.data.v3(
        section='Default',
        key='ftp_username',
        raw=vsftpd_cfg_ftp_username,
        default='ftp',
        hint='str',
        order=52
        )
      }}"
    _vsftpd_cfg_ftpd_banner: "{{ {} | r_pufky.data.v3(
        section='Default',
        key='ftpd_banner',
        raw=vsftpd_cfg_ftpd_banner,
        default='',
        hint='str',
        order=53
        )
      }}"
    _vsftpd_cfg_guest_enable: "{{ {} | r_pufky.data.v3(
        section='Default',
        key='guest_enable',
        raw=vsftpd_cfg_guest_enable,
        data=(
          vsftpd_cfg_guest_enable or
          vsftpd_srv_virtual_users | length > 0
        ),
        hint='bool',
        comment='Enable if virtual users set (guest_enable=true).',
        order=54
        )
      }}"
    _vsftpd_cfg_guest_username: "{{ {} | r_pufky.data.v3(
        section='Default',
        key='guest_username',
        raw=vsftpd_cfg_guest_username,
        default='ftp',
        hint='str',
        order=55
        )
      }}"
    _vsftpd_cfg_hide_file: "{{ {} | r_pufky.data.v3(
        section='Default',
        key='hide_file',
        raw=vsftpd_cfg_hide_file,
        data=(
          '{' + vsftpd_cfg_hide_file | join(',') + '}'
          if vsftpd_cfg_hide_file | length > 0 else
          ''
        ),
        default=[],
        hint='list of str',
        order=56
        )
      }}"
    _vsftpd_cfg_hide_ids: "{{ {} | r_pufky.data.v3(
        section='Default',
        key='hide_ids',
        raw=vsftpd_cfg_hide_ids,
        default=false,
        hint='bool',
        order=57
        )
      }}"
    _vsftpd_cfg_idle_session_timeout: "{{ {} | r_pufky.data.v3(
        section='Default',
        key='idle_session_timeout',
        raw=vsftpd_cfg_idle_session_timeout,
        default=300,
        hint='int',
        order=58
        )
      }}"
    _vsftpd_cfg_implicit_ssl: "{{ {} | r_pufky.data.v3(
        section='Default',
        key='implicit_ssl',
        raw=vsftpd_cfg_implicit_ssl,
        default=false,
        hint='bool',
        order=59
        )
      }}"
    _vsftpd_cfg_listen: "{{ {} | r_pufky.data.v3(
        section='Default',
        key='listen',
        raw=vsftpd_cfg_listen,
        default=false,
        hint='bool',
        order=60
        )
      }}"
    _vsftpd_cfg_listen_address6: "{{ {} | r_pufky.data.v3(
        section='Default',
        key='listen_address6',
        raw=vsftpd_cfg_listen_address6,
        default='',
        hint='str',
        order=61
        )
      }}"
    _vsftpd_cfg_listen_address: "{{ {} | r_pufky.data.v3(
        section='Default',
        key='listen_address',
        raw=vsftpd_cfg_listen_address,
        default='',
        hint='str',
        order=62
        )
      }}"
    _vsftpd_cfg_listen_ipv6: "{{ {} | r_pufky.data.v3(
        section='Default',
        key='listen_ipv6',
        raw=vsftpd_cfg_listen_ipv6,
        default=true,
        hint='bool',
        order=63
        )
      }}"
    _vsftpd_cfg_listen_port: "{{ {} | r_pufky.data.v3(
        section='Default',
        key='listen_port',
        raw=vsftpd_cfg_listen_port,
        default=21,
        hint='int',
        order=64
        )
      }}"
    _vsftpd_cfg_local_enable: "{{ {} | r_pufky.data.v3(
        section='Default',
        key='local_enable',
        raw=vsftpd_cfg_local_enable,
        default=true,
        hint='bool',
        order=65
        )
      }}"
    _vsftpd_cfg_local_max_rate: "{{ {} | r_pufky.data.v3(
        section='Default',
        key='local_max_rate',
        raw=vsftpd_cfg_local_max_rate,
        default=0,
        hint='int',
        order=66
        )
      }}"
    _vsftpd_cfg_local_root: "{{ {} | r_pufky.data.v3(
        section='Default',
        key='local_root',
        raw=vsftpd_cfg_local_root,
        default='',
        hint='str',
        order=67
        )
      }}"
    _vsftpd_cfg_local_umask: "{{ {} | r_pufky.data.v3(
        section='Default',
        key='local_umask',
        raw=vsftpd_cfg_local_umask,
        default='077',
        hint='str',
        order=68
        )
      }}"
    _vsftpd_cfg_lock_upload_files: "{{ {} | r_pufky.data.v3(
        section='Default',
        key='lock_upload_files',
        raw=vsftpd_cfg_lock_upload_files,
        default=true,
        hint='bool',
        order=69
        )
      }}"
    _vsftpd_cfg_log_ftp_protocol: "{{ {} | r_pufky.data.v3(
        section='Default',
        key='log_ftp_protocol',
        raw=vsftpd_cfg_log_ftp_protocol,
        default=false,
        hint='bool',
        order=70
        )
      }}"
    _vsftpd_cfg_ls_recurse_enable: "{{ {} | r_pufky.data.v3(
        section='Default',
        key='ls_recurse_enable',
        raw=vsftpd_cfg_ls_recurse_enable,
        default=false,
        hint='bool',
        order=71
        )
      }}"
    _vsftpd_cfg_max_clients: "{{ {} | r_pufky.data.v3(
        section='Default',
        key='max_clients',
        raw=vsftpd_cfg_max_clients,
        default=2000,
        hint='int',
        order=72
        )
      }}"
    _vsftpd_cfg_max_login_fails: "{{ {} | r_pufky.data.v3(
        section='Default',
        key='max_login_fails',
        raw=vsftpd_cfg_max_login_fails,
        default=3,
        hint='int',
        order=73
        )
      }}"
    _vsftpd_cfg_max_per_ip: "{{ {} | r_pufky.data.v3(
        section='Default',
        key='max_per_ip',
        raw=vsftpd_cfg_max_per_ip,
        default=50,
        hint='int',
        order=74
        )
      }}"
    _vsftpd_cfg_mdtm_write: "{{ {} | r_pufky.data.v3(
        section='Default',
        key='mdtm_write',
        raw=vsftpd_cfg_mdtm_write,
        default=true,
        hint='bool',
        order=75
        )
      }}"
    _vsftpd_cfg_message_file: "{{ {} | r_pufky.data.v3(
        section='Default',
        key='message_file',
        raw=vsftpd_cfg_message_file,
        default='.message',
        hint='str',
        order=76
        )
      }}"
    _vsftpd_cfg_no_anon_password: "{{ {} | r_pufky.data.v3(
        section='Default',
        key='no_anon_password',
        raw=vsftpd_cfg_no_anon_password,
        default=false,
        hint='bool',
        order=77
        )
      }}"
    _vsftpd_cfg_no_log_lock: "{{ {} | r_pufky.data.v3(
        section='Default',
        key='no_log_lock',
        raw=vsftpd_cfg_no_log_lock,
        default=false,
        hint='bool',
        order=78
        )
      }}"
    _vsftpd_cfg_nopriv_user: "{{ {} | r_pufky.data.v3(
        section='Default',
        key='nopriv_user',
        raw=vsftpd_cfg_nopriv_user,
        default='nobody',
        hint='str',
        order=79
        )
      }}"
    _vsftpd_cfg_one_process_model: "{{ {} | r_pufky.data.v3(
        section='Default',
        key='one_process_model',
        raw=vsftpd_cfg_one_process_model,
        default=false,
        hint='bool',
        order=80
        )
      }}"
    _vsftpd_cfg_pam_service_name: "{{ {} | r_pufky.data.v3(
        section='Default',
        key='pam_service_name',
        raw=vsftpd_cfg_pam_service_name,
        data=(
          'vsftpd_virtual'
          if vsftpd_srv_virtual_users | length > 0 else
          vsftpd_cfg_pam_service_name
        ),
        default='vsftpd',
        _dest=(
          vsftpd_role_pam_dir ~ '/vsftpd_virtual'
          if vsftpd_srv_virtual_users | length > 0 else
          vsftpd_role_pam_dir ~ '/' ~ vsftpd_cfg_pam_service_name
        ),
        hint='str',
        comment='Enable if virtual users set (vsftpd_virtual module).',
        order=81
        )
      }}"
    _vsftpd_cfg_passwd_chroot_enable: "{{ {} | r_pufky.data.v3(
        section='Default',
        key='passwd_chroot_enable',
        raw=vsftpd_cfg_passwd_chroot_enable,
        default=false,
        hint='bool',
        order=82
        )
      }}"
    _vsftpd_cfg_pasv_addr_resolve: "{{ {} | r_pufky.data.v3(
        section='Default',
        key='pasv_addr_resolve',
        raw=vsftpd_cfg_pasv_addr_resolve,
        default=false,
        hint='bool',
        order=83
        )
      }}"
    _vsftpd_cfg_pasv_address: "{{ {} | r_pufky.data.v3(
        section='Default',
        key='pasv_address',
        raw=vsftpd_cfg_pasv_address,
        default='',
        hint='str',
        order=84
        )
      }}"
    _vsftpd_cfg_pasv_enable: "{{ {} | r_pufky.data.v3(
        section='Default',
        key='pasv_enable',
        raw=vsftpd_cfg_pasv_enable,
        default=true,
        hint='bool',
        order=85
        )
      }}"
    _vsftpd_cfg_pasv_max_port: "{{ {} | r_pufky.data.v3(
        section='Default',
        key='pasv_max_port',
        raw=vsftpd_cfg_pasv_max_port,
        default=0,
        hint='int',
        order=86
        )
      }}"
    _vsftpd_cfg_pasv_min_port: "{{ {} | r_pufky.data.v3(
        section='Default',
        key='pasv_min_port',
        raw=vsftpd_cfg_pasv_min_port,
        default=0,
        hint='int',
        order=87
        )
      }}"
    _vsftpd_cfg_pasv_promiscuous: "{{ {} | r_pufky.data.v3(
        section='Default',
        key='pasv_promiscuous',
        raw=vsftpd_cfg_pasv_promiscuous,
        default=false,
        hint='bool',
        order=88
        )
      }}"
    _vsftpd_cfg_port_enable: "{{ {} | r_pufky.data.v3(
        section='Default',
        key='port_enable',
        raw=vsftpd_cfg_port_enable,
        default=true,
        hint='bool',
        order=89
        )
      }}"
    _vsftpd_cfg_port_promiscuous: "{{ {} | r_pufky.data.v3(
        section='Default',
        key='port_promiscuous',
        raw=vsftpd_cfg_port_promiscuous,
        default=false,
        hint='bool',
        order=90
        )
      }}"
    _vsftpd_cfg_require_cert: "{{ {} | r_pufky.data.v3(
        section='Default',
        key='require_cert',
        raw=vsftpd_cfg_require_cert,
        default=false,
        hint='bool',
        added='2.0.6',
        order=91
        )
      }}"
    _vsftpd_cfg_require_ssl_reuse: "{{ {} | r_pufky.data.v3(
        section='Default',
        key='require_ssl_reuse',
        raw=vsftpd_cfg_require_ssl_reuse,
        default=true,
        hint='bool',
        added='2.1.0',
        order=92
        )
      }}"
    _vsftpd_cfg_rsa_cert_file: "{{ {} | r_pufky.data.v3(
        section='Default',
        key='rsa_cert_file',
        raw=vsftpd_cfg_rsa_cert_file,
        data=(
          '/etc/ssl/certs/ssl-cert-snakeoil.pem'
          if vsftpd_cfg_rsa_cert_file | length == 0 else
          vsftpd_role_service_dir ~ '/rsa.pem'
        ),
        default='',
        _src=vsftpd_cfg_rsa_cert_file | regex_replace('\\/$', ''),
        _dest=vsftpd_role_service_dir ~ '/rsa.pem',
        hint='str',
        sensitive=true,
        order=93
        )
      }}"
    _vsftpd_cfg_rsa_private_key_file: "{{ {} | r_pufky.data.v3(
        section='Default',
        key='rsa_private_key_file',
        raw=vsftpd_cfg_rsa_private_key_file,
        data=(
          '/etc/ssl/private/ssl-cert-snakeoil.key'
          if vsftpd_cfg_rsa_private_key_file | length == 0 else
          vsftpd_role_service_dir ~ '/rsa.key'
        ),
        default='',
        _src=vsftpd_cfg_rsa_private_key_file | regex_replace('\\/$', ''),
        _dest=vsftpd_role_service_dir ~ '/rsa.key',
        hint='str',
        sensitive=true,
        order=94
        )
      }}"
    _vsftpd_cfg_run_as_launching_user: "{{ {} | r_pufky.data.v3(
        section='Default',
        key='run_as_launching_user',
        raw=vsftpd_cfg_run_as_launching_user,
        default=false,
        hint='bool',
        order=95
        )
      }}"
    _vsftpd_cfg_secure_chroot_dir: "{{ {} | r_pufky.data.v3(
        section='Default',
        key='secure_chroot_dir',
        raw=vsftpd_cfg_secure_chroot_dir | regex_replace('\\/$', ''),
        default='/usr/share/empty',
        hint='str',
        order=96
        )
      }}"
    _vsftpd_cfg_secure_email_list_enable: "{{ {} | r_pufky.data.v3(
        section='Default',
        key='secure_email_list_enable',
        raw=vsftpd_cfg_secure_email_list_enable,
        default=false,
        hint='bool',
        order=97
        )
      }}"
    _vsftpd_cfg_session_support: "{{ {} | r_pufky.data.v3(
        section='Default',
        key='session_support',
        raw=vsftpd_cfg_session_support,
        default=false,
        hint='bool',
        order=98
        )
      }}"
    _vsftpd_cfg_setproctitle_enable: "{{ {} | r_pufky.data.v3(
        section='Default',
        key='setproctitle_enable',
        raw=vsftpd_cfg_setproctitle_enable,
        default=false,
        hint='bool',
        order=99
        )
      }}"
    _vsftpd_cfg_ssl_ciphers: "{{ {} | r_pufky.data.v3(
        section='Default',
        key='ssl_ciphers',
        raw=vsftpd_cfg_ssl_ciphers,
        default='DES-CBC3-SHA',
        hint='str',
        order=100
        )
      }}"
    _vsftpd_cfg_ssl_enable: "{{ {} | r_pufky.data.v3(
        section='Default',
        key='ssl_enable',
        raw=vsftpd_cfg_ssl_enable,
        default=false,
        hint='bool',
        order=101
        )
      }}"
    _vsftpd_cfg_ssl_request_cert: "{{ {} | r_pufky.data.v3(
        section='Default',
        key='ssl_request_cert',
        raw=vsftpd_cfg_ssl_request_cert,
        default=true,
        hint='bool',
        added='2.0.7',
        sensitive=true,
        order=102
        )
      }}"
    _vsftpd_cfg_ssl_sslv2: "{{ {} | r_pufky.data.v3(
        section='Default',
        key='ssl_sslv2',
        raw=vsftpd_cfg_ssl_sslv2,
        default=false,
        hint='bool',
        order=103
        )
      }}"
    _vsftpd_cfg_ssl_sslv3: "{{ {} | r_pufky.data.v3(
        section='Default',
        key='ssl_sslv3',
        raw=vsftpd_cfg_ssl_sslv3,
        default=false,
        hint='bool',
        order=104
        )
      }}"
    _vsftpd_cfg_ssl_tlsv1: "{{ {} | r_pufky.data.v3(
        section='Default',
        key='ssl_tlsv1',
        raw=vsftpd_cfg_ssl_tlsv1,
        default=true,
        hint='bool',
        order=105
        )
      }}"
    _vsftpd_cfg_strict_ssl_read_eof: "{{ {} | r_pufky.data.v3(
        section='Default',
        key='strict_ssl_read_eof',
        raw=vsftpd_cfg_strict_ssl_read_eof,
        default=false,
        hint='bool',
        added='2.00.7',
        order=106
        )
      }}"
    _vsftpd_cfg_strict_ssl_write_shutdown: "{{ {} | r_pufky.data.v3(
        section='Default',
        key='strict_ssl_write_shutdown',
        raw=vsftpd_cfg_strict_ssl_write_shutdown,
        default=false,
        hint='bool',
        added='2.0.7',
        order=107
        )
      }}"
    _vsftpd_cfg_syslog_enable: "{{ {} | r_pufky.data.v3(
        section='Default',
        key='syslog_enable',
        raw=vsftpd_cfg_syslog_enable,
        default=false,
        hint='bool',
        order=108
        )
      }}"
    _vsftpd_cfg_tcp_wrappers: "{{ {} | r_pufky.data.v3(
        section='Default',
        key='tcp_wrappers',
        raw=vsftpd_cfg_tcp_wrappers,
        default=false,
        hint='bool',
        order=109
        )
      }}"
    _vsftpd_cfg_text_userdb_names: "{{ {} | r_pufky.data.v3(
        section='Default',
        key='text_userdb_names',
        raw=vsftpd_cfg_text_userdb_names,
        default=false,
        hint='bool',
        order=110
        )
      }}"
    _vsftpd_cfg_tilde_user_enable: "{{ {} | r_pufky.data.v3(
        section='Default',
        key='tilde_user_enable',
        raw=vsftpd_cfg_tilde_user_enable,
        default=false,
        hint='bool',
        added='0.10.0',
        order=111
        )
      }}"
    _vsftpd_cfg_trans_chunk_size: "{{ {} | r_pufky.data.v3(
        section='Default',
        key='trans_chunk_size',
        raw=vsftpd_cfg_trans_chunk_size,
        default=0,
        hint='int',
        order=112
        )
      }}"
    _vsftpd_cfg_upload_file: "{{ {} | r_pufky.data.v3(
        section='Default',
        key='upload_file',
        raw=vsftpd_cfg_upload_file,
        data=(
          '{' + vsftpd_cfg_upload_file | join(',') + '}'
          if vsftpd_cfg_upload_file | length > 0 else
          ''
        ),
        default=[],
        hint='list of str',
        order=113
        )
      }}"
    _vsftpd_cfg_use_localtime: "{{ {} | r_pufky.data.v3(
        section='Default',
        key='use_localtime',
        raw=vsftpd_cfg_use_localtime,
        default=true,
        hint='bool',
        order=114
        )
      }}"
    _vsftpd_cfg_use_sendfile: "{{ {} | r_pufky.data.v3(
        section='Default',
        key='use_sendfile',
        raw=vsftpd_cfg_use_sendfile,
        default=true,
        hint='bool',
        order=115
        )
      }}"
    _vsftpd_cfg_user_config_dir: "{{ {} | r_pufky.data.v3(
        section='Default',
        key='user_config_dir',
        raw=vsftpd_cfg_user_config_dir,
        data=(
          vsftpd_role_service_dir ~ '/user_config'
          if vsftpd_cfg_user_config_dir | length > 0 else
          ''
        ),
        _src=vsftpd_cfg_user_config_dir | regex_replace('\\/$', '') ~ '/',
        _dest=vsftpd_role_service_dir ~ '/user_config',
        hint='str',
        order=116
        )
      }}"
    _vsftpd_cfg_user_sub_token: "{{ {} | r_pufky.data.v3(
        section='Default',
        key='user_sub_token',
        raw=vsftpd_cfg_user_sub_token,
        default='',
        hint='str',
        order=117
        )
      }}"
    _vsftpd_cfg_userlist_deny: "{{ {} | r_pufky.data.v3(
        section='Default',
        key='userlist_deny',
        raw=vsftpd_cfg_userlist_deny,
        default=true,
        hint='bool',
        order=118
        )
      }}"
    _vsftpd_cfg_userlist_enable: "{{ {} | r_pufky.data.v3(
        section='Default',
        key='userlist_enable',
        raw=vsftpd_cfg_userlist_enable,
        default=false,
        hint='bool',
        order=119
        )
      }}"
    _vsftpd_cfg_userlist: "{{ {} | r_pufky.data.v3(
        section='Default',
        key='userlist_file',
        raw=vsftpd_cfg_userlist,
        data=(
          vsftpd_role_service_dir ~ '/user_list'
          if vsftpd_cfg_userlist | length > 0 else
          ''
        ),
        default=[],
        _dest=vsftpd_role_service_dir ~ '/user_list',
        hint='list of str',
        order=120
        )
      }}"
    _vsftpd_cfg_validate_cert: "{{ {} | r_pufky.data.v3(
        section='Default',
        key='validate_cert',
        raw=vsftpd_cfg_validate_cert,
        default=false,
        hint='bool',
        added='2.0.6',
        order=121
        )
      }}"
    _vsftpd_cfg_vsftpd_log_file: "{{ {} | r_pufky.data.v3(
        section='Default',
        key='vsftpd_log_file',
        raw=vsftpd_cfg_vsftpd_log_file,
        default='/var/log/vsftpd.log',
        hint='str',
        order=122
        )
      }}"
    _vsftpd_cfg_virtual_use_local_privs: "{{ {} | r_pufky.data.v3(
        section='Default',
        key='virtual_use_local_privs',
        raw=vsftpd_cfg_virtual_use_local_privs,
        default=false,
        hint='bool',
        order=123
        )
      }}"
    _vsftpd_cfg_write_enable: "{{ {} | r_pufky.data.v3(
        section='Default',
        key='write_enable',
        raw=vsftpd_cfg_write_enable,
        default=false,
        hint='bool',
        order=124
        )
      }}"
    _vsftpd_cfg_xferlog_enable: "{{ {} | r_pufky.data.v3(
        section='Default',
        key='xferlog_enable',
        raw=vsftpd_cfg_xferlog_enable,
        default=true,
        hint='bool',
        order=125
        )
      }}"
    _vsftpd_cfg_xferlog_file: "{{ {} | r_pufky.data.v3(
        section='Default',
        key='xferlog_file',
        raw=vsftpd_cfg_xferlog_file,
        default='/var/log/xferlog',
        hint='str',
        order=126
        )
      }}"
    _vsftpd_cfg_xferlog_std_format: "{{ {} | r_pufky.data.v3(
        section='Default',
        key='xferlog_std_format',
        raw=vsftpd_cfg_xferlog_std_format,
        default=false,
        hint='bool',
        order=127
        )
      }}"
    _vsftpd_cfg_debian_utf8_filesystem: "{{ {} | r_pufky.data.v3(
        section='Debian Specific Patches',
        key='utf8_filesystem',
        raw=vsftpd_cfg_debian_utf8_filesystem,
        default=false,
        hint='bool',
        order=128
        )
      }}"

- name: 'Annotate | sanitize & annotate service defaults'
  ansible.builtin.set_fact:  # noqa jinja[spacing] readability.
    _vsftpd_srv_virtual_users: "{{ {} | r_pufky.data.v3(
        raw=vsftpd_srv_virtual_users,
        default=[],
        _dest=vsftpd_role_service_dir ~ '/virtual_users',
        hint='list of dict',
        order=1
        )
      }}"
    _vsftpd_srv_harden_enable: "{{ {} | r_pufky.data.v3(
        raw=vsftpd_srv_harden_enable,
        default=false,
        hint='bool',
        order=2
        )
      }}"
    _vsftpd_srv_harden_rw_paths: "{{ {} | r_pufky.data.v3(
        raw=vsftpd_srv_harden_rw_paths,
        default=[
          _vsftpd_cfg_local_root.raw,
          _vsftpd_cfg_anon_root.raw,
          _vsftpd_cfg_vsftpd_log_file.raw,
          _vsftpd_cfg_xferlog_file.raw,
          '/srv/ftp'
        ],
        hint='list of str',
        order=3
        )
      }}"
    _vsftpd_srv_harden_ro_paths: "{{ {} | r_pufky.data.v3(
        raw=vsftpd_srv_harden_ro_paths,
        default=[],
        hint='list of str',
        order=4
        )
      }}"
    _vsftpd_srv_harden_inaccessible_paths: "{{ {} | r_pufky.data.v3(
        raw=vsftpd_srv_harden_inaccessible_paths,
        default=[],
        hint='list of str',
        order=5
        )
      }}"
    _vsftpd_srv_user: "{{ {} | r_pufky.data.v3(
        raw=vsftpd_srv_user,
        default='ftp',
        _uid='',
        _home='',
        hint='str',
        order=6
        )
      }}"
    _vsftpd_srv_user_home_mode: "{{ {} | r_pufky.data.v3(
        raw=vsftpd_srv_user_home_mode,
        default='0755',
        hint='str',
        order=7
        )
      }}"
    _vsftpd_srv_group: "{{ {} | r_pufky.data.v3(
        raw=vsftpd_srv_group,
        default='ftp',
        _gid='',
        hint='str',
        order=8
        )
      }}"
    _vsftpd_srv_create_user: "{{ {} | r_pufky.data.v3(
        raw=vsftpd_srv_create_user,
        default=true,
        hint='bool',
        order=9
        )
      }}"
    _vsftpd_srv_user_data_manage_enable: "{{ {} | r_pufky.data.v3(
        raw=vsftpd_srv_user_data_manage_enable,
        default=false,
        hint='bool',
        added='3.0.0',
        order=10
        )
      }}"
    _vsftpd_srv_local_root_user: "{{ {} | r_pufky.data.v3(
        raw=vsftpd_srv_local_root_user,
        default='ftp',
        _uid='',
        hint='str',
        order=11
        )
      }}"
    _vsftpd_srv_local_root_group: "{{ {} | r_pufky.data.v3(
        raw=vsftpd_srv_local_root_group,
        default='ftp',
        _gid='',
        hint='str',
        order=12
        )
      }}"
    _vsftpd_srv_local_root_mode: "{{ {} | r_pufky.data.v3(
        raw=vsftpd_srv_local_root_mode,
        default='0770',
        hint='str',
        order=13
        )
      }}"
    _vsftpd_srv_local_root_recursive_enable: "{{ {} | r_pufky.data.v3(
        raw=vsftpd_srv_local_root_recursive_enable,
        default=true,
        hint='bool',
        order=14
        )
      }}"
    _vsftpd_srv_anon_root_user: "{{ {} | r_pufky.data.v3(
        raw=vsftpd_srv_anon_root_user,
        default='ftp',
        _uid='',
        hint='str',
        order=15
        )
      }}"
    _vsftpd_srv_anon_root_group: "{{ {} | r_pufky.data.v3(
        raw=vsftpd_srv_anon_root_group,
        default='ftp',
        _gid='',
        hint='str',
        order=16
        )
      }}"
    _vsftpd_srv_anon_root_mode: "{{ {} | r_pufky.data.v3(
        raw=vsftpd_srv_anon_root_mode,
        default='0770',
        hint='str',
        order=17
        )
      }}"
    _vsftpd_srv_anon_root_recursive_enable: "{{ {} | r_pufky.data.v3(
        raw=vsftpd_srv_anon_root_recursive_enable,
        default=true,
        hint='bool',
        order=18
        )
      }}"

- name: 'Annotate | generate config map'
  ansible.builtin.set_fact:
    _vsftpd_map: '{{
        hostvars[inventory_hostname] | dict2items |
        selectattr("key", "match", "_vsftpd_cfg_*")
      }}'
    _vsftpd_order:
      - 'Default'
      - 'Debian Specific Patches'
